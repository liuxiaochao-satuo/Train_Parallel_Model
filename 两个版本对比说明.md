# Labelme转COCO：两个版本对比说明

## 快速选择指南

### 使用场景判断

```
你有标注bounding box（rectangle）吗？
├─ 是 → 使用 labelme2coco_example.py（原始版本）
└─ 否 → 使用 labelme2coco_bottomup.py（新版本）
```

---

## 详细对比

### 版本1：`labelme2coco_example.py`（原始版本）

**适用场景**：自顶向下（Top-Down）姿态估计

**输入要求**：
- ✅ 必须有 `rectangle`（边界框）
- ✅ 有 `point`（关键点）
- ✅ 可选 `polygon`（分割掩码）

**转换逻辑**：
```
遍历所有rectangle
  ↓
计算bbox（从rectangle）
  ↓
匹配polygon（空间位置）
  ↓
匹配point（空间位置）
  ↓
生成annotation
```

**关键点**：
- 以rectangle为中心
- 通过空间位置匹配关键点
- 可见性固定为2

**示例输入**：
```json
{
  "shapes": [
    {"shape_type": "rectangle", "points": [[100,100], [200,200]]},
    {"shape_type": "point", "label": "nose", "points": [[150,120]]}
  ]
}
```

---

### 版本2：`labelme2coco_bottomup.py`（新版本）

**适用场景**：自底向上（Bottom-Up）姿态估计

**输入要求**：
- ✅ 只需要 `point`（关键点）
- ✅ 必须有 `group_id`（标识不同的人）
- ❌ 不需要 `rectangle`
- ❌ 不需要 `polygon`

**转换逻辑**：
```
按group_id分组关键点
  ↓
从关键点计算bbox
  ↓
按顺序排列关键点
  ↓
生成annotation
```

**关键点**：
- 以group_id为中心
- 从关键点自动计算bbox
- 可见性从description读取

**示例输入**：
```json
{
  "shapes": [
    {"shape_type": "point", "label": "nose", "group_id": 1, "description": "2", "points": [[150,120]]},
    {"shape_type": "point", "label": "left_eye", "group_id": 1, "description": "2", "points": [[140,110]]}
  ]
}
```

---

## 核心区别总结

| 特性 | 原始版本 | 新版本 |
|------|---------|--------|
| **输入格式** | rectangle + point | 只有point |
| **分组方式** | 空间位置匹配 | group_id分组 |
| **bbox来源** | 从rectangle提取 | 从关键点计算 |
| **可见性** | 固定为2 | 从description读取 |
| **group_id** | 不需要 | **必须** |
| **适用方法** | 自顶向下 | 自底向上 |

---

## 你的情况

根据你的描述：
- ✅ 只标注了关键点（point）
- ✅ 用于自底向上姿态估计
- ❌ 没有标注bounding box

**结论**：应该使用 **`labelme2coco_bottomup.py`**（新版本）

---

## 使用步骤

### 1. 检查你的标注文件

确保每个关键点都有：
```json
{
  "label": "nose",
  "shape_type": "point",
  "group_id": 1,        // ← 必须存在！
  "description": "2",   // ← 可见性（0/1/2）
  "points": [[x, y]]
}
```

### 2. 运行转换脚本

```bash
python labelme2coco_bottomup.py
```

### 3. 检查输出

```bash
# 查看输出文件
cat output_coco/coco_bottomup.json

# 或使用pycocotools验证
python -c "from pycocotools.coco import COCO; c = COCO('output_coco/coco_bottomup.json'); print(f'图像: {len(c.imgs)}, 标注: {len(c.anns)}')"
```

---

## 常见问题

### Q: 我的标注文件没有group_id怎么办？

**A**: 需要添加group_id。可以使用Labelme重新标注，或者：
1. 手动编辑JSON文件添加group_id
2. 使用脚本批量添加（需要根据实际情况编写）

### Q: 两个版本可以同时使用吗？

**A**: 可以，但输出到不同的文件：
- 原始版本：`output_coco/coco_sample.json`
- 新版本：`output_coco/coco_bottomup.json`

### Q: 转换后的bbox准确吗？

**A**: 新版本从关键点计算的bbox可能不够精确（只是包围所有关键点），但对于自底向上方法，bbox主要用于格式兼容性，训练时可能不使用。

---

## 推荐工作流程

### 对于自底向上方法：

```
1. 使用Labelme标注关键点
   ├─ 为每个关键点设置group_id（标识不同的人）
   ├─ 设置description（可见性：0/1/2）
   └─ 确保关键点标签符合标准

2. 使用check_json.py检查标注
   └─ 确保格式正确

3. 使用labelme2coco_bottomup.py转换
   └─ 生成COCO格式文件

4. 使用pycocotools验证
   └─ 确保格式正确
```

---

## 总结

- **你的情况**：只标注了关键点，用于自底向上方法
- **推荐版本**：`labelme2coco_bottomup.py`
- **关键要求**：确保所有关键点都有`group_id`
- **注意事项**：bbox会自动计算，关键点顺序必须正确

